<!DOCTYPE html>




 <html class="no-js"> 
<head>

<script type="text/javascript">
theBaseUrl = "http://vamp.io/";
</script>
<base href="http://vamp.io/" />

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
  <title>Kubernetes 1.x - Vamp</title>
  <meta name="generator" content="Hugo 0.16" />

  
  <meta name="description" content="Vamp - Deploy and manage microservices with power and ease.">
  
  <link rel="canonical" href="./documentation/installation/kubernetes/">
  
  <meta name="author" content="magnetic.io">
  

  <meta property="og:url" content="/documentation/installation/kubernetes/">
  <meta property="og:title" content="Vamp">
  <meta property="og:image" content="/images/logo.svg">
  <meta name="apple-mobile-web-app-title" content="Vamp">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="shortcut icon" type="image/x-icon" href="./images/logo.svg">
  <link rel="icon" type="image/x-icon" href="./images/logo.svg">


  <style>
    @font-face {
      font-family: 'Icon';
      src: url('fonts/icon.eot?52m981');
      src: url('fonts/icon.eot?#iefix52m981')
      format('embedded-opentype'),
      url('fonts/icon.woff?52m981')
      format('woff'),
      url('fonts/icon.ttf?52m981')
      format('truetype'),
      url('fonts/icon.svg?52m981#icon')
      format('svg');
      font-weight: normal;
      font-style: normal;
    }
  </style>

  <link rel="stylesheet" href="css/style.css">

  <script src="js/vendor.js"></script>

  <script src="js/app.js"></script>

  
</head>
<body class="palette-primary-pink palette-accent-pink">


<div class="single-page">
  <nav aria-label="Header" id="header" class="top-menu">
  <div class="left">
    <a href="./">
      <div id="logo" class="logo"></div>
    </a>
  </div>

  <div class="right">
    <div class="top-menu-items" id="top-menu-items">

    </div>

    <div class="download">
      <a href="./documentation/installation/hello-world/" class="button button--red">
        Try Vamp
      </a>
    </div>

    <a href="https://github.com/magneticio/vamp" target="_blank" class="github-logo">
      <i class="fa fa-2x fa-github" aria-hidden="true"></i>
    </a>

    <div class="search-button">
      <i class="fa fa-lg fa-search"></i>
    </div>

  </div>
</nav>

<ul id="mobile-menu" style="display: none">
</ul>

<div id="search">
  <div class="search-bar">
    <div class="search-bar__back">
      <i class="fa fa-lg fa-times"></i>
    </div>
    <input class="search-bar__input" placeholder="Type your search here...">
  </div>
  <div class="search-results">
    <ul></ul>
  </div>
</div>


</div>

<div class="page documentation">
    <div class="menu" id="side-menu">
    </div>
    <div class="content">
      <h1 class="content-header">Kubernetes 1.x </h1>
      <div class="markdowned">
        

<p>The installation will run Vamp together with etcd, Elasticsearch and Logstash on Google container engine and kubernetes. (We will also deploy our demo Sava application to give you something to play around on). Before you begin, it is advisable to try out the official Quickstart for Google Container Engine tutorial first (<a href="https://cloud.google.com/container-engine/docs/quickstart">google.com - container engine quickstart</a>).</p>

<div class="admonition note">
  <p class="admonition-title">Note!</p>
  <p>Kubernetes support is still in Alpha.</p>
</div>

<h4 id="tested-against">Tested against</h4>

<p>This guide has been tested on Kubernetes 1.2 and 1.3. Minikube can also be used. (<a href="https://github.com/kubernetes/minikube">github.com - minikube</a>)</p>

<h4 id="requirements">Requirements</h4>

<ul>
<li>Google Container Engine cluster</li>
<li>Key-value store (like ZooKeeper, Consul or etcd)</li>
<li>Elasticsearch and Logstash</li>
</ul>

<h3 id="step-1-create-a-new-gke-cluster">Step 1: Create a new GKE cluster:</h3>

<p>The simple way to create a new GKE cluster:</p>

<ol>
<li>open Google Cloud Shell</li>
<li>set a zone, e.g. <code>gcloud config set compute/zone europe-west1-b</code></li>
<li>create a cluster <code>vamp</code> using default parameters: <code>gcloud container clusters create vamp</code></li>
</ol>

<p>After the (new) Kubernetes cluster is setup, we are going to continue with the installation using the Kubernetes CLI <code>kubectl</code>.
You can use <code>kubectl</code> directly from the Google Cloud Shell, e.g. to check the Kubernetes client and server version:</p>

<pre><code class="language-bash">$ kubectl version
</code></pre>

<h3 id="step-2-deploy-etcd-elasticsearch-and-logstash">Step 2: Deploy etcd, Elasticsearch and Logstash</h3>

<p>Let&rsquo;s deploy <code>etcd</code> - the installation is based on this tutorial (<a href="https://github.com/coreos/etcd/tree/master/hack/kubernetes-deploy">github.com/coreos - etcd on Kubernetes</a>).
Execute:</p>

<pre><code class="language-bash">$ kubectl create \
        -f https://raw.githubusercontent.com/magneticio/vamp-docker/master/vamp-kubernetes/etcd.yml
</code></pre>

<p>Deploy Elasticsearch and Logstash with a proper Vamp Logstash configuration (<a href="https://github.com/magneticio/elastic">github.com/magneticio - elastic</a>):</p>

<pre><code class="language-bash">$ kubectl run elastic --image=magneticio/elastic:2.2
$ kubectl expose deployment elastic --protocol=TCP --port=9200 --name=elasticsearch
$ kubectl expose deployment elastic --protocol=UDP --port=10001 --name=logstash
$ kubectl expose deployment elastic --protocol=TCP --port=5601 --name=kibana
</code></pre>

<div class="admonition note">
  <p class="admonition-title">Note!</p>
  <p>This is not a production grade setup. You would also need to take care of persistence and running multiple replicas of each pod.</p>
</div>

<h3 id="step-3-run-vamp">Step 3: Run Vamp</h3>

<p>Let&rsquo;s run Vamp gateway agent as a <code>daemon set</code> first:</p>

<pre><code class="language-bash">$ kubectl create \
        -f https://raw.githubusercontent.com/magneticio/vamp-docker/master/vamp-kubernetes/vga.yml
</code></pre>

<p>To deploy Vamp, execute:</p>

<pre><code class="language-bash">$ kubectl run vamp --image=magneticio/vamp:0.9.0-kubernetes
$ kubectl expose deployment vamp --protocol=TCP --port=8080 --name=vamp --type=&quot;LoadBalancer&quot;
</code></pre>

<p>The Vamp image uses the following configuration (<a href="https://github.com/magneticio/vamp-docker/blob/master/vamp-kubernetes/application.conf">github.com/magneticio - Vamp kubernetes configuration</a>).</p>

<p>Wait a bit until Vamp is running and check out the Kubernetes services:</p>

<pre><code class="language-bash">$ kubectl get services
</code></pre>

<p>The output should be similar to this:</p>

<pre><code>NAME                 CLUSTER-IP     EXTERNAL-IP      PORT(S)             AGE
elasticsearch        10.3.242.188   &lt;none&gt;           9200/TCP            4m
etcd-client          10.3.247.112   &lt;none&gt;           2379/TCP            4m
etcd0                10.3.251.13    &lt;none&gt;           2379/TCP,2380/TCP   4m
etcd1                10.3.251.103   &lt;none&gt;           2379/TCP,2380/TCP   4m
etcd2                10.3.250.20    &lt;none&gt;           2379/TCP,2380/TCP   4m
kubernetes           10.3.240.1     &lt;none&gt;           443/TCP             5m
logstash             10.3.254.16    &lt;none&gt;           10001/UDP           4m
vamp                 10.3.242.93    146.148.118.45   8080/TCP            2m
vamp-gateway-agent   10.3.254.234   146.148.22.145   80/TCP              2m
</code></pre>

<p>Notice that the Vamp UI is exposed (in this example) on <code>http://146.148.118.45:8080</code></p>

<h3 id="step-4-deploy-the-sava-demo-application">Step 4: Deploy the Sava demo application</h3>

<pre><code class="language-yaml">---
name: sava:1.0
gateways:
  9050: sava/port
clusters:
  sava:
    services:
      breed:
        name: sava:1.0.0
        deployable: magneticio/sava:1.0.0
        ports:
          port: 8080/http
      scale:
        cpu: 0.2       
        memory: 64MB
        instances: 1
</code></pre>

<div class="admonition note">
  <p class="admonition-title">Note!</p>
  <p>Be sure that the cluster has enough resources (CPU, memory), otherwise deployments will be in pending state.</p>
</div>

<p>Once it&rsquo;s running we can check if all Vamp Gateway Agent services are up:</p>

<pre><code class="language-bash">$ kubectl get services --show-labels -l vamp=gateway
</code></pre>

<p>We can see that for each gateway a new service is created:</p>

<pre><code>NAME                      CLUSTER-IP     EXTERNAL-IP     PORT(S)     AGE       LABELS
hex1f8c9a0157c9fe3335e9   10.3.243.199   104.155.24.47   9050/TCP    2m        lookup_name=a7ad6869e65e9c047f956cf7d1b4d01a89e
ef486,vamp=gateway
hex26bb0695e9a85ec34b03   10.3.245.85    23.251.143.62   40000/TCP   2m        lookup_name=6ace45cb2c155e85bd0c84123d1dab5a6cb
12c97,vamp=gateway
</code></pre>

<div class="admonition note">
  <p class="admonition-title">Note!</p>
  <p>In this setup Vamp is deliberately configured to initiate exposure of all gateway and VGA ports. This would not be the case if the default and recommended setting are used.</p>
</div>

<p>Now we can access our <code>sava</code> service on <code>http://104.155.24.47:9050</code></p>

<p>The default Kubernetes service type can be set in configuration: <code>vamp.container-driver.kubernetes.service-type</code>, possible values are <code>LoadBalancer</code> or <code>NodePort</code>.</p>

<p>We can also access gateways using virtual hosts. Vamp Gateway Agent service is on IP <code>146.148.22.145</code> in this example, so:</p>

<pre><code class="language-bash">$ curl --resolve 9050.sava-1-0.vamp:80:146.148.22.145 -v http://9050.sava-1-0.vamp
</code></pre>

<div class="admonition note">
  <p class="admonition-title">Note!</p>
  <p>Don&rsquo;t forget to clean up your Kubernetes cluster and firewall rules  if you don&rsquo;t want to use them anymore (<a href="https://cloud.google.com/container-engine/docs/quickstart#clean-up">google.com - container engine quickstart: clean up</a>).</p>
</div>

<div class="admonition note">
  <p class="admonition-title">What next?</p>
  <p><ul>
<li>Once you have Vamp up and running you can jump into the <a href="./documentation/tutorials/">getting started tutorials</a>.</li>
<li>Things still not running? <a href="https://github.com/magneticio/vamp/issues">We&rsquo;re here to help →</a></li>
</ul>

<p>If you need help you can find us on <a href="https://gitter.im/magneticio/vamp">Gitter</a></p>
</div>

      </div>
    </div>
</div>

<div class="lander-row lander-row--blue footer">
  <div class="container">
    <div class="row">
      <div class="col col-3">
        <h2 class="h2">Learn more</h2>
        <a href="./why-use-vamp/">
          <p class="text">Why use Vamp?</p>
        </a>
        <a href="./documentation/how-vamp-works/architecture-and-components">
          <p class="text">Documentation</p>
        </a>
        <a href="./about/">
          <p class="text">About us</p>
        </a>
        <a href="./resources/news/">
          <p class="text">News</p>
        </a>
        <a href="./contact/">
          <p class="text">Contact</p>
        </a>
      </div>
        <div class="col col-6">
        <h2 class="h2">All things code</h2>
          <a href="./support/">
            <p class="text">Support</p>
          </a>
          <a href="./resources/community/">
            <p class="text">Community</p>
          </a>
          <a href="https://github.com/magneticio/vamp" target="_blank">
            <p class="text">GitHub</p>
          </a>
          <a href="https://gitter.im/magneticio/vamp" target="_blank">
            <p class="text">Gitter</p>
          </a>
      </div>
      <div class="col col-6">
        <h2 class="h2">Stay up to date</h2>
        <p class="text">
          Leave your email for the latest news: We won’t spam you and won’t go off topic.
        </p>

        <form action="//magnetic.us9.list-manage.com/subscribe/post?u=c709b3ab8cce9e00d617e01b6&amp;id=c1465e21d0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate form-inline" style="display: inline" target="_blank" novalidate="">
          <div class="input-group">
            <input type="email" name="EMAIL" id="mce-EMAIL" placeholder="Email">
            <a onclick="$(this).closest('form').submit()" class="button button--red not-active">
              <div class="button__icon button__icon--mail">
              </div>
            </a>
          </div>
        </form>

        
          
        


        <div class="social-buttons">
          <p class="text">Follow us on: </p>
          <a href="https://twitter.com/vamp_io" target="_blank">
            <i class="fa fa-2x fa-twitter"></i>
          </a>

          <a href="https://www.linkedin.com/company/magnetic-io" target="_blank">
            <i class="fa fa-2x fa-linkedin"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="footer-bottom lander-row--blue">
  <div class="container">
    <div class="part">
      <a href="./about/"><img class="magnetic-logo" src="./img/005-vamp/Logo/magnetic-logo-footer.svg" alt=""></a>
    </div>
    <div class="part">
      <img class="vamp-bat" src="./img/003-Small-icons/Medium-blue/VAMP-Medium.svg" alt="">
      <p class="text">Code licensed under <a type="application/rss+xml" href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache 2</a> © 2016 <a href="./about/">Magnetic.io</a></p>
    </div>
  </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59948816-1', 'auto');
  ga('send', 'pageview');

</script>

