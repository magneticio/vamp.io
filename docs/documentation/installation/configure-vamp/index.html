<!DOCTYPE html>




 <html class="no-js"> 
<head>

<script type="text/javascript">
theBaseUrl = "http://vamp.io/";
</script>
<base href="http://vamp.io/" />

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
  <title>Configure Vamp - Vamp</title>
  <meta name="generator" content="Hugo 0.16" />

  
  <meta name="description" content="Vamp - Deploy and manage microservices with power and ease.">
  
  <link rel="canonical" href="./documentation/installation/configure-vamp/">
  
  <meta name="author" content="magnetic.io">
  

  <meta property="og:url" content="/documentation/installation/configure-vamp/">
  <meta property="og:title" content="Vamp">
  <meta property="og:image" content="/images/logo.svg">
  <meta name="apple-mobile-web-app-title" content="Vamp">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="shortcut icon" type="image/x-icon" href="./images/logo.svg">
  <link rel="icon" type="image/x-icon" href="./images/logo.svg">


  <style>
    @font-face {
      font-family: 'Icon';
      src: url('fonts/icon.eot?52m981');
      src: url('fonts/icon.eot?#iefix52m981')
      format('embedded-opentype'),
      url('fonts/icon.woff?52m981')
      format('woff'),
      url('fonts/icon.ttf?52m981')
      format('truetype'),
      url('fonts/icon.svg?52m981#icon')
      format('svg');
      font-weight: normal;
      font-style: normal;
    }
  </style>

  <link rel="stylesheet" href="css/style.css">

  <script src="js/vendor.js"></script>

  <script src="js/app.js"></script>

  
</head>
<body class="palette-primary-pink palette-accent-pink">


<div class="single-page">
  <nav aria-label="Header" id="header" class="top-menu">
  <div class="left">
    <a href="./">
      <div id="logo" class="logo"></div>
    </a>
  </div>

  <div class="right">
    <div class="top-menu-items" id="top-menu-items">

    </div>

    <div class="download">
      <a href="./documentation/installation/hello-world/" class="button button--red">
        Try Vamp
      </a>
    </div>

    <a href="https://github.com/magneticio/vamp" target="_blank" class="github-logo">
      <i class="fa fa-2x fa-github" aria-hidden="true"></i>
    </a>

    <div class="search-button">
      <i class="fa fa-lg fa-search"></i>
    </div>

  </div>
</nav>

<ul id="mobile-menu" style="display: none">
</ul>

<div id="search">
  <div class="search-bar">
    <div class="search-bar__back">
      <i class="fa fa-lg fa-times"></i>
    </div>
    <input class="search-bar__input" placeholder="Type your search here...">
  </div>
  <div class="search-results">
    <ul></ul>
  </div>
</div>


</div>

<div class="page documentation">
    <div class="menu" id="side-menu">
    </div>
    <div class="content">
      <h1 class="content-header">Configure Vamp </h1>
      <div class="markdowned">
        

<p>Vamp can be configured using one or a combination of the Vamp <code>application.conf</code> HOCON file (<a href="https://github.com/typesafehub/config">github.com/typesafehub - config</a>), environment variables and system properties.</p>

<p>For example:</p>

<pre><code class="language-bash">
export VAMP_INFO_MESSAGE=Hello # overriding Vamp info message (vamp.info.message)

java -Dvamp.gateway-driver.host=localhost \
     -Dlogback.configurationFile=logback.xml \
     -Dconfig.file=application.conf \
     -jar vamp.jar
</code></pre>

<h2 id="the-vamp-application-conf-file">The Vamp <code>application.conf</code> file</h2>

<p>The Vamp <code>application.conf</code> consists of the following sections. All sections are nested inside a parent <code>vamp {}</code> tag.</p>

<ul>
<li><a href="./documentation/installation/configure-vamp/#rest-api">rest-api</a></li>
<li><a href="./documentation/installation/configure-vamp/#persistence">persistence</a></li>
<li><a href="./documentation/installation/configure-vamp/#container-drivers">container-drivers</a></li>
<li><a href="./documentation/installation/configure-vamp/#gateway-driver">gateway-driver</a></li>
<li><a href="./documentation/installation/configure-vamp/#operation">operation</a></li>
</ul>

<h3 id="rest-api">rest-api</h3>

<p>Configure the port, host name and interface that Vamp runs on using the <code>rest-api.port</code></p>

<pre><code>vamp {
  rest-api {
    interface = 0.0.0.0
    host = localhost
    port = 8080
    response-timeout = 10 seconds # HTTP response time out
  }
}    
</code></pre>

<h3 id="persistence">persistence</h3>

<div class="admonition note">
  <p class="admonition-title">Updated for Vamp 0.9.1</p>
  <p><ul>
<li>In the <a href="./documentation/installation/configure-vamp/#persistence">Vamp configuration</a> we set <code>persistence caching</code> by default to <code>false</code>. In our Vamp images we set this to <code>true</code> to make it easier on the persistence store load. Check out this <a href="https://github.com/magneticio/vamp/blob/master/bootstrap/src/main/resources/reference.conf">default Vamp 0.9.1 configuration</a> for reference.</li>
<li>We&rsquo;ve added a key-value store as a persistence data store. Check out this <a href="https://github.com/magneticio/vamp/blob/master/bootstrap/src/main/resources/reference.conf">default Vamp 0.9.1 configuration</a> for reference.</li>
</ul>
</p>
</div>

<p>Vamp uses Elasticsearch for persistence and ZooKeeper (<a href="https://zookeeper.apache.org/">apache.org - ZooKeeper</a>), etcd (<a href="https://coreos.com/etcd/docs/latest/">coreos.com  - etcd documentation</a>) or Consul (<a href="https://www.consul.io/">consul.io</a>) for key-value store (keeping HAProxy configuration).</p>

<pre><code class="language-yaml">vamp {
  persistence {
    response-timeout = 5 seconds

    database {
      type: &quot;elasticsearch&quot; # elasticsearch or in-memory (no persistence)
      elasticsearch.url = ${vamp.pulse.elasticsearch.url}
    }

    key-value-store {

      type = &quot;zookeeper&quot;    # zookeeper, etcd or consul
      base-path = &quot;/vamp&quot;   # base path for keys, e.g. /vamp/...

      zookeeper {
        servers = &quot;192.168.99.100:2181&quot;
      }

      etcd {
        url = &quot;http://192.168.99.100:2379&quot;
      }

      consul {
        url = &quot;http://192.168.99.100:8500&quot;
      }
    }
  }
}
</code></pre>

<p><code>zookeeper</code>, <code>etcd</code> or <code>consul</code> configuration is needed based on the type, e.g. if <code>type = &quot;zookeeper&quot;</code> then only <code>zookeeper.servers</code> should be set.</p>

<h3 id="container-drivers">Container drivers</h3>

<p>Vamp can be configured to work with the following container drivers:</p>

<ul>
<li><a href="#docker">Docker</a></li>
<li><a href="#mesos-marathon">Mesos/Marathon</a></li>
<li><a href="#kubernetes">Kubernetes</a></li>
<li><a href="#rancher">Rancher</a></li>
</ul>

<h4 id="docker">Docker</h4>

<p>Vamp can talk directly to a Docker daemon and its driver is configured by default. This is useful for local testing, Docker Swarm support is coming soon.
Vamp can even run inside Docker while deploying to Docker.</p>

<ol>
<li>Install Docker as per Docker&rsquo;s installation manual (<a href="https://docs.docker.com/engine/installation/">docs.docker.com - install Docker engine</a>)</li>

<li><p>Check the <code>DOCKER_*</code> environment variables Vamp uses to connect to Docker, i.e.</p>

<pre><code>DOCKER_HOST=tcp://192.168.99.100:2376
export DOCKER_MACHINE_NAME=default
DOCKER_TLS_VERIFY=1
DOCKER_CERT_PATH=/Users/tim/.docker/machine/machines/default
</code></pre></li>

<li><p>If Vamp can&rsquo;t find these environment variables, it falls back to using the <code>unix:///var/run/docker.sock</code> Unix socket for communicating with Docker.</p></li>

<li><p>Update the container-driver section in Vamp&rsquo;s config file. If you use a package installer like <code>yum</code> or <code>apt-get</code> you can find this file in <code>/usr/share/vamp/conf/application.conf</code>:</p>

<pre><code>...
container-driver {
  type = &quot;docker&quot;
  response-timeout = 30 # seconds, timeout for container operations
}
...
</code></pre></li>

<li><p>(Re)start Vamp by restarting the Java process by hand.</p></li>
</ol>

<h4 id="mesos-marathon">Mesos/Marathon</h4>

<p>Vamp can use the full power of Marathon running on either a DCOS cluster or custom Mesos cluster. You can use Vamp&rsquo;s DSL, or you can pass native Marathon options by <a href="./documentation/using-vamp/blueprints/#dialects">using a dialect in a blueprint.</a></p>

<ol>
<li><p>Set up a DCOS cluster using Mesosphere&rsquo;s assisted install on AWS (<a href="https://mesosphere.com/product/">mesosphere.com - product</a>).<br />
If you prefer, you can build your own Mesos/Marathon cluster. Here are some tutorials and scripts to help you get started:</p>

<ul>
<li>Mesos Ansible playbook (<a href="https://github.com/mhamrah/ansible-mesos-playbook">github.com/mhamrah - ansible mesos playbook</a>)</li>
<li>Mesos Vagrant (<a href="https://github.com/everpeace/vagrant-mesos">github.com/everpeace - vagrant-mesos</a>)</li>
<li>Mesos Terraform (<a href="https://github.com/ContainerSolutions/terraform-mesos">github.com/ContainerSolutions - Terraform Mesos</a>)</li>
</ul></li>

<li><p>Whichever way you set up Marathon, in the end you should be able to see something like this:<br />
<img src="./images/screens/marathon-screenshot.png" alt="" /></p></li>

<li><p>Make a note of the Marathon endpoint (host:port) and update the container-driver section in <a href="./documentation/installation/configure-vamp/">Vamp&rsquo;s config file</a>. If you use a package installer like <code>yum</code> or <code>apt-get</code> you can find this file in <code>/usr/share/vamp/conf/application.conf</code>. Set the &ldquo;url&rdquo; option to the Marathon endpoint.</p>

<pre><code>...
container-driver {
  type = &quot;marathon&quot;
  url = &quot;http://&lt;marathon_host&gt;:&lt;marathon_port&gt;&quot;
  response-timeout = 30 # seconds, timeout for container operations
}
...
</code></pre></li>

<li><p>(Re)start Vamp by restarting the Java process by hand.</p></li>
</ol>

<h4 id="kubernetes">Kubernetes</h4>

<p>Specify Kubernetes as the container driver in the Vamp <code>application.conf</code> file.</p>

<p>Taken from the example <code>application.conf</code> file for Kubernetes (<a href="https://github.com/magneticio/vamp-docker/blob/master/vamp-kubernetes/application.conf">github.com/magneticio - vamp-kubernetes</a>):</p>

<pre><code>  ...
  container-driver {

    type = &quot;kubernetes&quot;

    kubernetes {
      url = &quot;https://kubernetes&quot;
      service-type = &quot;LoadBalancer&quot;
    }
    ...
</code></pre>

<h4 id="rancher">Rancher</h4>

<p>Specify Rancher as the container driver in the Vamp <code>application.conf</code> file.</p>

<p>Taken from the example <code>application.conf</code> file for Rancher (<a href="https://github.com/magneticio/vamp-docker/blob/master/vamp-rancher/application.conf">github.com/magneticio - vamp-rancher</a>):</p>

<pre><code>  ...
  container-driver.type = &quot;rancher&quot;
  ...

</code></pre>

<h3 id="gateway-driver">gateway-driver</h3>

<p>The gateway-driver section configures how traffic should be routed through Vamp Gateway Agent. See the below example on how to configure this:</p>

<pre><code class="language-yaml">vamp {
  gateway-driver {
    host: &quot;10.193.238.26&quot;              # Vamp Gateway Agent / Haproxy, internal IP.
    response-timeout: 30 seconds

    haproxy {
      ip: 127.0.0.1                    # HAProxy backend server IP

      template: &quot;&quot;                     # Path to template file, if not specified default will be used

      virtual-hosts {
        ip: &quot;127.0.0.1&quot;                # IP, if virtual hosts are enabled
        port: 40800                    # Port, if virtual hosts are enabled
      }
    }
  }
}  
</code></pre>

<p>The reason for the need to configure <code>vamp.gateway-driver.host</code> is that when services are deployed, they need to be able to find Vamp Gateway Agent in their respective networks. This can be a totally different network than where Vamp is running.
Let&rsquo;s use an example: <code>frontend</code> and <code>backend</code> service, <code>frontend</code> depends on <code>backend</code> - in Vamp DSL that would be 2 clusters (assuming the same deployment).
There are different ways how <code>frontend</code> can discover its dependency <code>backend</code>, and to make things simpler Vamp supports using specific environment parameters.</p>

<pre><code class="language-yaml">---
name: my-web-app
clusters:
  frontend:
    services:
      breed:
        name: my-frontend:1.0.0
        deployable: magneticio/my-frontend:1.0.0
        ports:
          port: 8080/http
        environment_variables:
          BACKEND: http://$backend.host:$backend.ports.port
        dependencies:
          backend: my-backend:1.0.0
  backend:
    services:
      breed:
        name: my-backend:1.0.0
        deployable: magneticio/my-backend:1.0.0
        ports:
          port: 8080/http

</code></pre>

<p>In this example <code>$backend.host</code> will have the value of the <code>vamp.gateway-driver.host</code> configuration parameter, while <code>$backend.ports.port</code> the next available port from <code>vamp.operation.gateway.port-range</code>.
<code>frontend</code> doesn&rsquo;t connect to <code>backend</code> directly but via Vamp Gateway Agent(s) - given on these host and port parameters.
This is quite simmilar to common pattern to access any clustered application.
For instance if you want to access DB server, you will have an address string based on e.g. DNS name or something simmilar.
Note that even without Vamp, you would need to setup access to <code>backend</code> in some similar way.
With Vamp, access is via VGA&rsquo;s and that allows specific routing (conditions, weights) needed for A/B testing and canary releasing.
Additional information can be found on <a href="./documentation/how-vamp-works/service-discovery/">service discovery page</a>.</p>

<h3 id="operation">operation</h3>

<p>The operation section holds all parameters that control how Vamp executes against &ldquo;external&rdquo; services: this also includes Vamp Pulse and Vamp Gateway Agent.</p>

<pre><code class="language-yaml">operation {
  sla.period = 5 seconds        # controls how often an SLA checks against metrics
  escalation.period = 5 seconds # controls how often Vamp checks for escalation events
	synchronization {
    period = 4 seconds          # controls how often Vamp performs
                                # a sync between Vamp and the container driver.
    timeout {
      ready-for-deployment: 600	seconds   # controls how long Vamp waits for a
                                          # service to start. If the service is not started
                                          # before this time, the service is registered as &quot;error&quot;
      ready-for-undeployment: 600 seconds # similar to &quot;ready-for-deployment&quot;, but for
                                          # the removal of services.
    }
   }

  gateway {
    port-range = 40000-45000
    response-timeout = 5 seconds # timeout for container operations

    virtual-hosts.formats {      # name format
      gateway                 = &quot;$gateway.vamp&quot;
      deployment-port         = &quot;$port.$deployment.vamp&quot;
      deployment-cluster-port = &quot;$port.$cluster.$deployment.vamp&quot;
    }
  }

  deployment {
    scale {         # default scale, if not specified in blueprint
      instances: 1
      cpu: 1
      memory: 1GB
    }

    arguments: []   # split by first '=',
                    # Docker command line arguments, e.g. &quot;security-opt=seccomp:unconfined&quot;
  }
}
</code></pre>

<p>For each cluster and service port within the same cluster a gateway is created - this is exactly as one that can be created using Gateway API.
That means specific conditions and weights can be applied on traffic to/from cluster services - A/B testing and canary releases support.
<code>vamp.operation.gateway.port-range</code> is range of port values that can be used for these cluster/port gateways.
These ports need to be available on all Vamp Gateway Agent hosts.</p>

<h2 id="environment-variables">Environment variables</h2>

<p>Each configuration parameter can be replaced by an environment variable. Environment variables have precedence over configuration from <code>application.conf</code> or system properties.  Read more about <a href="./documentation/using-vamp/environment-variables/">environment variables</a>.</p>

<h3 id="environment-variable-names">Environment variable names</h3>

<p>Environment variable names are based on the configuration parameter name converted to upper case. All non-alphanumerics should be replaced by an underscore <code>_</code></p>

<pre><code>vamp.info.message           ⇒ VAMP_INFO_MESSAGE
vamp.gateway-driver.timeout ⇒ VAMP_GATEWAY_DRIVER_TIMEOUT
</code></pre>

<div class="admonition note">
  <p class="admonition-title">What next?</p>
  <p><ul>
<li>Follow the <a href="./documentation/tutorials/">getting started tutorials</a></li>
<li>You can read in depth about <a href="./documentation/using-vamp/artifacts/">using Vamp</a> or browse the <a href="./documentation/api/api-reference/">API reference</a> or <a href="./documentation/cli/cli-reference/">CLI reference</a> docs.</li>
</ul>
</p>
</div>

      </div>
    </div>
</div>

<div class="lander-row lander-row--blue footer">
  <div class="container">
    <div class="row">
      <div class="col col-3">
        <h2 class="h2">Learn more</h2>
        <a href="./why-use-vamp/">
          <p class="text">Why use Vamp?</p>
        </a>
        <a href="./documentation/how-vamp-works/architecture-and-components">
          <p class="text">Documentation</p>
        </a>
        <a href="./about/">
          <p class="text">About us</p>
        </a>
        <a href="./resources/news/">
          <p class="text">News</p>
        </a>
        <a href="./contact/">
          <p class="text">Contact</p>
        </a>
      </div>
        <div class="col col-6">
        <h2 class="h2">All things code</h2>
          <a href="./support/">
            <p class="text">Support</p>
          </a>
          <a href="./resources/community/">
            <p class="text">Community</p>
          </a>
          <a href="https://github.com/magneticio/vamp" target="_blank">
            <p class="text">GitHub</p>
          </a>
          <a href="https://gitter.im/magneticio/vamp" target="_blank">
            <p class="text">Gitter</p>
          </a>
      </div>
      <div class="col col-6">
        <h2 class="h2">Stay up to date</h2>
        <p class="text">
          Leave your email for the latest news: We won’t spam you and won’t go off topic.
        </p>

        <form action="//magnetic.us9.list-manage.com/subscribe/post?u=c709b3ab8cce9e00d617e01b6&amp;id=c1465e21d0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate form-inline" style="display: inline" target="_blank" novalidate="">
          <div class="input-group">
            <input type="email" name="EMAIL" id="mce-EMAIL" placeholder="Email">
            <a onclick="$(this).closest('form').submit()" class="button button--red not-active">
              <div class="button__icon button__icon--mail">
              </div>
            </a>
          </div>
        </form>

        
          
        


        <div class="social-buttons">
          <p class="text">Follow us on: </p>
          <a href="https://twitter.com/vamp_io" target="_blank">
            <i class="fa fa-2x fa-twitter"></i>
          </a>

          <a href="https://www.linkedin.com/company/magnetic-io" target="_blank">
            <i class="fa fa-2x fa-linkedin"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="footer-bottom lander-row--blue">
  <div class="container">
    <div class="part">
      <a href="./about/"><img class="magnetic-logo" src="./img/005-vamp/Logo/magnetic-logo-footer.svg" alt=""></a>
    </div>
    <div class="part">
      <img class="vamp-bat" src="./img/003-Small-icons/Medium-blue/VAMP-Medium.svg" alt="">
      <p class="text">Code licensed under <a type="application/rss+xml" href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache 2</a> © 2016 <a href="./about/">Magnetic.io</a></p>
    </div>
  </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59948816-1', 'auto');
  ga('send', 'pageview');

</script>

